<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ATP Finals Tournament Bracket - Interattivo</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #1a2a6c, #2a3a7c);
        color: #fff;
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .tournament-info {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 20px;
      }

      .info-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 10px 20px;
        border-radius: 20px;
        font-size: 0.9rem;
      }

      .tournament-structure {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        justify-content: center;
      }

      .section-title {
        text-align: center;
        margin: 30px 0 15px;
        font-size: 1.5rem;
        color: #ffcc00;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      /* Stili per i gironi */
      .groups-container {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        justify-content: center;
        margin-bottom: 40px;
      }

      .group {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        padding: 20px;
        width: 300px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .group-title {
        text-align: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        color: #ffcc00;
      }

      .player {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        margin-bottom: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 5px;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .player:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
      }

      .player.selected-first {
        background: rgba(76, 175, 80, 0.3);
        border-left: 4px solid #4caf50;
      }

      .player.selected-second {
        background: rgba(33, 150, 243, 0.3);
        border-left: 4px solid #2196f3;
      }

      .player-icon {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        font-weight: bold;
      }

      .player-name {
        font-weight: 600;
        flex-grow: 1;
      }

      .player-stats {
        display: flex;
        gap: 15px;
        font-size: 0.9rem;
        color: #ccc;
      }

      /* Stili per le fasi finali */
      .knockout-stage {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 40px;
        margin-top: 20px;
      }

      .bracket {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .bracket-title {
        text-align: center;
        margin-bottom: 10px;
        color: #ffcc00;
      }

      .match {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        padding: 15px;
        width: 250px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .match.winner {
        background: rgba(76, 175, 80, 0.2);
        border: 1px solid rgba(76, 175, 80, 0.5);
      }

      .match-player {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        cursor: pointer;
      }

      .match-player:last-child {
        border-bottom: none;
      }

      .match-player.winner {
        font-weight: bold;
        color: #4caf50;
      }

      .match-player:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .player-info {
        display: flex;
        align-items: center;
      }

      .final-match {
        background: rgba(255, 204, 0, 0.1);
        border: 2px solid rgba(255, 204, 0, 0.3);
        padding: 20px;
        width: 280px;
        position: relative;
      }

      .final-match::before {
        content: "FINALE";
        position: absolute;
        top: -12px;
        left: 50%;
        transform: translateX(-50%);
        background: #ffcc00;
        color: #1a2a6c;
        padding: 3px 15px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: bold;
      }

      .champion {
        text-align: center;
        margin-top: 30px;
        padding: 20px;
        background: rgba(255, 204, 0, 0.2);
        border-radius: 10px;
        border: 2px dashed rgba(255, 204, 0, 0.5);
      }

      .champion-title {
        font-size: 1.2rem;
        margin-bottom: 10px;
        color: #ffcc00;
      }

      .champion-name {
        font-size: 1.8rem;
        font-weight: bold;
        color: #ffcc00;
        text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
      }

      .instructions {
        text-align: center;
        margin: 20px 0;
        padding: 15px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
      }

      .reset-button,
      .submit-button {
        display: block;
        margin: 20px auto;
        padding: 12px 30px;
        background: #ffcc00;
        color: #1a2a6c;
        border: none;
        border-radius: 5px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1rem;
      }

      .reset-button:hover,
      .submit-button:hover {
        background: #ffd633;
        transform: scale(1.05);
      }

      .submit-button {
        background: #4caf50;
        color: white;
      }

      .submit-button:hover {
        background: #66bb6a;
      }

      .submit-button:disabled {
        background: #cccccc;
        cursor: not-allowed;
        transform: none;
      }

      .name-input-container {
        text-align: center;
        margin: 20px 0;
      }

      .name-input {
        padding: 10px 15px;
        border-radius: 5px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 1rem;
        width: 300px;
        max-width: 80%;
      }

      .name-input::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: #2a3a7c;
        padding: 30px;
        border-radius: 10px;
        max-width: 500px;
        width: 90%;
        text-align: center;
        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
      }

      .modal h2 {
        color: #ffcc00;
        margin-bottom: 20px;
      }

      .modal p {
        margin-bottom: 20px;
        line-height: 1.5;
      }

      .close-modal {
        padding: 10px 20px;
        background: #ffcc00;
        color: #1a2a6c;
        border: none;
        border-radius: 5px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .close-modal:hover {
        background: #ffd633;
      }

      .buttons-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
      }

      /* Responsive */
      @media (max-width: 1200px) {
        .tournament-structure {
          flex-direction: column;
          align-items: center;
        }
      }

      @media (max-width: 768px) {
        .groups-container {
          flex-direction: column;
          align-items: center;
        }

        .knockout-stage {
          flex-direction: column;
          align-items: center;
        }

        h1 {
          font-size: 2rem;
        }

        .buttons-container {
          flex-direction: column;
          align-items: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ATP Finals 2023 - Simulatore</h1>
        <p>Torino, Italia - 12-19 Novembre 2023</p>
        <div class="tournament-info">
          <div class="info-item">Surface: Indoor Hard</div>
          <div class="info-item">Prize: $15,000,000</div>
          <div class="info-item">Format: Round Robin + Knockout</div>
        </div>
      </header>

      <div class="instructions">
        <h3>Come utilizzare il simulatore:</h3>
        <p>1. Inserisci il tuo nome</p>
        <p>
          2. Seleziona il primo e secondo classificato di ogni girone (clicca
          sui giocatori)
        </p>
        <p>3. Nelle semifinali, clicca sul vincitore di ogni match</p>
        <p>4. Nella finale, clicca sul vincitore del torneo</p>
        <p>5. Clicca su "Invia pronostico" per salvare le tue selezioni</p>
      </div>

      <div class="name-input-container">
        <input
          type="text"
          class="name-input"
          id="user-name"
          placeholder="Inserisci il tuo nome"
        />
      </div>

      <form id="tournament-form">
        <div class="tournament-structure">
          <!-- Fase a gironi -->
          <div class="groups-section">
            <h2 class="section-title">Fase a Gironi</h2>
            <div class="groups-container">
              <!-- Gruppo Verde -->
              <div class="group" data-group="green">
                <h3 class="group-title">Gruppo Verde</h3>
                <div class="player" data-player="djokovic">
                  <div class="player-icon">N</div>
                  <span class="player-name">Novak Djokovic</span>
                  <div class="player-stats">
                    <span>3-0</span>
                    <span>6-1</span>
                  </div>
                </div>
                <div class="player" data-player="sinner">
                  <div class="player-icon">J</div>
                  <span class="player-name">Jannik Sinner</span>
                  <div class="player-stats">
                    <span>2-1</span>
                    <span>5-3</span>
                  </div>
                </div>
                <div class="player" data-player="tsitsipas">
                  <div class="player-icon">S</div>
                  <span class="player-name">Stefanos Tsitsipas</span>
                  <div class="player-stats">
                    <span>1-2</span>
                    <span>3-5</span>
                  </div>
                </div>
                <div class="player" data-player="rune">
                  <div class="player-icon">H</div>
                  <span class="player-name">Holger Rune</span>
                  <div class="player-stats">
                    <span>0-3</span>
                    <span>1-6</span>
                  </div>
                </div>
              </div>

              <!-- Gruppo Rosso -->
              <div class="group" data-group="red">
                <h3 class="group-title">Gruppo Rosso</h3>
                <div class="player" data-player="alcaraz">
                  <div class="player-icon">C</div>
                  <span class="player-name">Carlos Alcaraz</span>
                  <div class="player-stats">
                    <span>2-1</span>
                    <span>5-3</span>
                  </div>
                </div>
                <div class="player" data-player="medvedev">
                  <div class="player-icon">D</div>
                  <span class="player-name">Daniil Medvedev</span>
                  <div class="player-stats">
                    <span>2-1</span>
                    <span>5-4</span>
                  </div>
                </div>
                <div class="player" data-player="zverev">
                  <div class="player-icon">A</div>
                  <span class="player-name">Alexander Zverev</span>
                  <div class="player-stats">
                    <span>1-2</span>
                    <span>4-5</span>
                  </div>
                </div>
                <div class="player" data-player="rublev">
                  <div class="player-icon">A</div>
                  <span class="player-name">Andrey Rublev</span>
                  <div class="player-stats">
                    <span>1-2</span>
                    <span>3-5</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Fase a eliminazione diretta -->
          <div class="knockout-section">
            <h2 class="section-title">Fase Finale</h2>
            <div class="knockout-stage">
              <!-- Semifinali -->
              <div class="bracket">
                <h3 class="bracket-title">Semifinali</h3>
                <div class="match" id="semifinal1">
                  <div class="match-player" data-player="green-first">
                    <div class="player-info">
                      <div class="player-icon">1</div>
                      <span>1° Classificato Gruppo Verde</span>
                    </div>
                  </div>
                  <div class="match-player" data-player="red-second">
                    <div class="player-info">
                      <div class="player-icon">2</div>
                      <span>2° Classificato Gruppo Rosso</span>
                    </div>
                  </div>
                </div>
                <div class="match" id="semifinal2">
                  <div class="match-player" data-player="red-first">
                    <div class="player-info">
                      <div class="player-icon">1</div>
                      <span>1° Classificato Gruppo Rosso</span>
                    </div>
                  </div>
                  <div class="match-player" data-player="green-second">
                    <div class="player-info">
                      <div class="player-icon">2</div>
                      <span>2° Classificato Gruppo Verde</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Finale -->
              <div class="bracket">
                <h3 class="bracket-title">Finale</h3>
                <div class="match final-match" id="final">
                  <div class="match-player" data-player="semifinal1-winner">
                    <div class="player-info">
                      <div class="player-icon">SF1</div>
                      <span>Vincitore Semifinale 1</span>
                    </div>
                  </div>
                  <div class="match-player" data-player="semifinal2-winner">
                    <div class="player-info">
                      <div class="player-icon">SF2</div>
                      <span>Vincitore Semifinale 2</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Campione -->
            <div class="champion" id="champion-section">
              <div class="champion-title">Campione ATP Finals 2023</div>
              <div class="champion-name" id="champion-name">
                Seleziona i vincitori
              </div>
            </div>
          </div>
        </div>

        <div class="buttons-container">
          <button type="button" class="reset-button" id="reset-button">
            Reset Torneo
          </button>
          <button
            type="button"
            class="submit-button"
            id="submit-button"
            disabled
          >
            Invia Pronostico
          </button>
        </div>
      </form>
    </div>

    <!-- Modal di conferma -->
    <div class="modal" id="confirmation-modal">
      <div class="modal-content">
        <h2>Pronostico Inviato!</h2>
        <p id="confirmation-message">
          Il tuo pronostico è stato registrato con successo.
        </p>
        <button class="close-modal" id="close-modal">Chiudi</button>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Stato del torneo
        const tournamentState = {
          userName: "",
          green: {
            first: null,
            second: null,
          },
          red: {
            first: null,
            second: null,
          },
          semifinals: {
            semifinal1: null,
            semifinal2: null,
          },
          final: {
            winner: null,
          },
        };

        // Elementi UI
        const userNameInput = document.getElementById("user-name");
        const submitButton = document.getElementById("submit-button");
        const confirmationModal = document.getElementById("confirmation-modal");
        const confirmationMessage = document.getElementById(
          "confirmation-message"
        );
        const closeModalButton = document.getElementById("close-modal");

        // Mappa dei giocatori
        const players = {
          djokovic: { name: "Novak Djokovic", initial: "N" },
          sinner: { name: "Jannik Sinner", initial: "J" },
          tsitsipas: { name: "Stefanos Tsitsipas", initial: "S" },
          rune: { name: "Holger Rune", initial: "H" },
          alcaraz: { name: "Carlos Alcaraz", initial: "C" },
          medvedev: { name: "Daniil Medvedev", initial: "D" },
          zverev: { name: "Alexander Zverev", initial: "A" },
          rublev: { name: "Andrey Rublev", initial: "A" },
        };

        // Abilita/disabilita il pulsante di invio in base al nome utente
        userNameInput.addEventListener("input", function () {
          tournamentState.userName = this.value.trim();
          updateSubmitButtonState();
        });

        // Selezione giocatori nei gironi
        document.querySelectorAll(".group .player").forEach((player) => {
          player.addEventListener("click", function () {
            const group = this.closest(".group").dataset.group;
            const playerId = this.dataset.player;

            // Se non è già selezionato come primo o secondo
            if (
              tournamentState[group].first !== playerId &&
              tournamentState[group].second !== playerId
            ) {
              // Se non c'è un primo classificato, assegna come primo
              if (!tournamentState[group].first) {
                tournamentState[group].first = playerId;
                this.classList.add("selected-first");
              }
              // Se c'è già un primo ma non un secondo, assegna come secondo
              else if (!tournamentState[group].second) {
                tournamentState[group].second = playerId;
                this.classList.add("selected-second");
              }
              // Se entrambi sono già selezionati, sostituisci il secondo
              else {
                // Rimuovi la selezione precedente del secondo
                const previousSecond = document.querySelector(
                  `.group[data-group="${group}"] .player[data-player="${tournamentState[group].second}"]`
                );
                previousSecond.classList.remove("selected-second");

                // Assegna il nuovo secondo
                tournamentState[group].second = playerId;
                this.classList.add("selected-second");
              }

              updateSemifinals();
              updateSubmitButtonState();
            }
          });
        });

        // Selezione vincitori delle semifinali
        document
          .querySelectorAll(
            "#semifinal1 .match-player, #semifinal2 .match-player"
          )
          .forEach((player) => {
            player.addEventListener("click", function () {
              const match = this.closest(".match");
              const matchId = match.id;

              // Rimuovi la selezione precedente in questo match
              match.querySelectorAll(".match-player").forEach((p) => {
                p.classList.remove("winner");
              });

              // Aggiungi la selezione al giocatore cliccato
              this.classList.add("winner");

              // Aggiorna lo stato del torneo
              if (matchId === "semifinal1") {
                tournamentState.semifinals.semifinal1 = this.dataset.player;
              } else {
                tournamentState.semifinals.semifinal2 = this.dataset.player;
              }

              updateFinal();
              updateSubmitButtonState();
            });
          });

        // Selezione vincitore della finale
        document.querySelectorAll("#final .match-player").forEach((player) => {
          player.addEventListener("click", function () {
            // Rimuovi la selezione precedente
            document.querySelectorAll("#final .match-player").forEach((p) => {
              p.classList.remove("winner");
            });

            // Aggiungi la selezione al giocatore cliccato
            this.classList.add("winner");

            // Aggiorna lo stato del torneo
            tournamentState.final.winner = this.dataset.player;

            updateChampion();
            updateSubmitButtonState();
          });
        });

        // Reset del torneo
        document
          .getElementById("reset-button")
          .addEventListener("click", function () {
            // Reset stato
            tournamentState.green.first = null;
            tournamentState.green.second = null;
            tournamentState.red.first = null;
            tournamentState.red.second = null;
            tournamentState.semifinals.semifinal1 = null;
            tournamentState.semifinals.semifinal2 = null;
            tournamentState.final.winner = null;

            // Reset UI
            document.querySelectorAll(".player").forEach((player) => {
              player.classList.remove("selected-first", "selected-second");
            });

            document.querySelectorAll(".match-player").forEach((player) => {
              player.classList.remove("winner");
              // Ripristina i placeholder
              if (player.dataset.player === "green-first") {
                player.querySelector("span").textContent =
                  "1° Classificato Gruppo Verde";
                player.querySelector(".player-icon").textContent = "1";
              } else if (player.dataset.player === "green-second") {
                player.querySelector("span").textContent =
                  "2° Classificato Gruppo Verde";
                player.querySelector(".player-icon").textContent = "2";
              } else if (player.dataset.player === "red-first") {
                player.querySelector("span").textContent =
                  "1° Classificato Gruppo Rosso";
                player.querySelector(".player-icon").textContent = "1";
              } else if (player.dataset.player === "red-second") {
                player.querySelector("span").textContent =
                  "2° Classificato Gruppo Rosso";
                player.querySelector(".player-icon").textContent = "2";
              } else if (player.dataset.player === "semifinal1-winner") {
                player.querySelector("span").textContent =
                  "Vincitore Semifinale 1";
                player.querySelector(".player-icon").textContent = "SF1";
              } else if (player.dataset.player === "semifinal2-winner") {
                player.querySelector("span").textContent =
                  "Vincitore Semifinale 2";
                player.querySelector(".player-icon").textContent = "SF2";
              }
            });

            document.getElementById("champion-name").textContent =
              "Seleziona i vincitori";
            updateSubmitButtonState();
          });

        // Invio del pronostico
        submitButton.addEventListener("click", function () {
          if (isFormComplete()) {
            sendPredictionToServer();
          }
        });

        // Chiudi il modal
        closeModalButton.addEventListener("click", function () {
          confirmationModal.style.display = "none";
        });

        // Funzione per aggiornare le semifinali
        function updateSemifinals() {
          // Aggiorna semifinale 1: 1° Verde vs 2° Rosso
          if (tournamentState.green.first && tournamentState.red.second) {
            const greenFirstPlayer = players[tournamentState.green.first];
            const redSecondPlayer = players[tournamentState.red.second];

            const greenFirstElement = document.querySelector(
              '#semifinal1 .match-player[data-player="green-first"]'
            );
            greenFirstElement.querySelector("span").textContent =
              greenFirstPlayer.name;
            greenFirstElement.querySelector(".player-icon").textContent =
              greenFirstPlayer.initial;

            const redSecondElement = document.querySelector(
              '#semifinal1 .match-player[data-player="red-second"]'
            );
            redSecondElement.querySelector("span").textContent =
              redSecondPlayer.name;
            redSecondElement.querySelector(".player-icon").textContent =
              redSecondPlayer.initial;
          }

          // Aggiorna semifinale 2: 1° Rosso vs 2° Verde
          if (tournamentState.red.first && tournamentState.green.second) {
            const redFirstPlayer = players[tournamentState.red.first];
            const greenSecondPlayer = players[tournamentState.green.second];

            const redFirstElement = document.querySelector(
              '#semifinal2 .match-player[data-player="red-first"]'
            );
            redFirstElement.querySelector("span").textContent =
              redFirstPlayer.name;
            redFirstElement.querySelector(".player-icon").textContent =
              redFirstPlayer.initial;

            const greenSecondElement = document.querySelector(
              '#semifinal2 .match-player[data-player="green-second"]'
            );
            greenSecondElement.querySelector("span").textContent =
              greenSecondPlayer.name;
            greenSecondElement.querySelector(".player-icon").textContent =
              greenSecondPlayer.initial;
          }
        }

        // Funzione per aggiornare la finale
        function updateFinal() {
          // Aggiorna finale con i vincitori delle semifinali
          if (
            tournamentState.semifinals.semifinal1 &&
            tournamentState.semifinals.semifinal2
          ) {
            let semifinal1Winner, semifinal2Winner;

            // Determina il vincitore della semifinale 1
            if (tournamentState.semifinals.semifinal1 === "green-first") {
              semifinal1Winner = players[tournamentState.green.first];
            } else {
              semifinal1Winner = players[tournamentState.red.second];
            }

            // Determina il vincitore della semifinale 2
            if (tournamentState.semifinals.semifinal2 === "red-first") {
              semifinal2Winner = players[tournamentState.red.first];
            } else {
              semifinal2Winner = players[tournamentState.green.second];
            }

            const finalPlayer1 = document.querySelector(
              '#final .match-player[data-player="semifinal1-winner"]'
            );
            finalPlayer1.querySelector("span").textContent =
              semifinal1Winner.name;
            finalPlayer1.querySelector(".player-icon").textContent =
              semifinal1Winner.initial;

            const finalPlayer2 = document.querySelector(
              '#final .match-player[data-player="semifinal2-winner"]'
            );
            finalPlayer2.querySelector("span").textContent =
              semifinal2Winner.name;
            finalPlayer2.querySelector(".player-icon").textContent =
              semifinal2Winner.initial;
          }
        }

        // Funzione per aggiornare il campione
        function updateChampion() {
          if (tournamentState.final.winner) {
            let champion;

            // Determina il campione in base al vincitore della finale
            if (tournamentState.final.winner === "semifinal1-winner") {
              if (tournamentState.semifinals.semifinal1 === "green-first") {
                champion = players[tournamentState.green.first];
              } else {
                champion = players[tournamentState.red.second];
              }
            } else {
              if (tournamentState.semifinals.semifinal2 === "red-first") {
                champion = players[tournamentState.red.first];
              } else {
                champion = players[tournamentState.green.second];
              }
            }

            document.getElementById("champion-name").textContent =
              champion.name;
          }
        }

        // Funzione per aggiornare lo stato del pulsante di invio
        function updateSubmitButtonState() {
          if (isFormComplete() && tournamentState.userName) {
            submitButton.disabled = false;
          } else {
            submitButton.disabled = true;
          }
        }

        // Funzione per verificare se il form è completo
        function isFormComplete() {
          return (
            tournamentState.green.first &&
            tournamentState.green.second &&
            tournamentState.red.first &&
            tournamentState.red.second &&
            tournamentState.semifinals.semifinal1 &&
            tournamentState.semifinals.semifinal2 &&
            tournamentState.final.winner
          );
        }

        // Funzione per inviare il pronostico al server
        // Funzione per inviare il pronostico al server
        async function sendPredictionToServer() {
          // Prepara i dati da inviare
          const predictionData = {
            userName: tournamentState.userName,
            predictions: {
              greenGroup: {
                first: players[tournamentState.green.first].name,
                second: players[tournamentState.green.second].name,
              },
              redGroup: {
                first: players[tournamentState.red.first].name,
                second: players[tournamentState.red.second].name,
              },
              semifinals: {
                semifinal1:
                  tournamentState.semifinals.semifinal1 === "green-first"
                    ? players[tournamentState.green.first].name
                    : players[tournamentState.red.second].name,
                semifinal2:
                  tournamentState.semifinals.semifinal2 === "red-first"
                    ? players[tournamentState.red.first].name
                    : players[tournamentState.green.second].name,
              },
              final: {
                winner:
                  tournamentState.final.winner === "semifinal1-winner"
                    ? tournamentState.semifinals.semifinal1 === "green-first"
                      ? players[tournamentState.green.first].name
                      : players[tournamentState.red.second].name
                    : tournamentState.semifinals.semifinal2 === "red-first"
                    ? players[tournamentState.red.first].name
                    : players[tournamentState.green.second].name,
              },
            },
          };

          try {
            // URL del backend - cambia con l'URL del tuo server
            const backendUrl =
              "https://atp-finals-backend-popostapo-7edfa465e9dd.herokuapp.com"; // o altro servizio di hosting

            const response = await fetch(`${backendUrl}/predictions`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(predictionData),
            });

            const result = await response.json();

            if (response.ok) {
              // Successo
              confirmationMessage.textContent = `Grazie ${tournamentState.userName}! Il tuo pronostico è stato registrato con successo.`;
              confirmationModal.style.display = "flex";

              // Salva anche nel localStorage come backup
              try {
                const existingPredictions =
                  JSON.parse(localStorage.getItem("atpPredictions")) || [];
                existingPredictions.push({
                  ...predictionData,
                  timestamp: new Date().toISOString(),
                  serverId: result.prediction?.id,
                });
                localStorage.setItem(
                  "atpPredictions",
                  JSON.stringify(existingPredictions)
                );
              } catch (e) {
                console.error("Errore nel salvataggio locale:", e);
              }
            } else {
              // Errore dal server
              throw new Error(result.error || "Errore del server");
            }
          } catch (error) {
            console.error("Errore nell'invio:", error);

            // Fallback: salva solo localmente
            try {
              const existingPredictions =
                JSON.parse(localStorage.getItem("atpPredictions")) || [];
              existingPredictions.push({
                ...predictionData,
                timestamp: new Date().toISOString(),
                localBackup: true,
              });
              localStorage.setItem(
                "atpPredictions",
                JSON.stringify(existingPredictions)
              );

              confirmationMessage.textContent = `Grazie ${tournamentState.userName}! Il tuo pronostico è stato salvato localmente (connessione al server non disponibile).`;
              confirmationModal.style.display = "flex";
            } catch (e) {
              confirmationMessage.textContent = `Errore nel salvataggio: ${error.message}`;
              confirmationModal.style.display = "flex";
            }
          }
        }
      });
    </script>
  </body>
</html>
